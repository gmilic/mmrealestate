mapboxgl.accessToken="pk.eyJ1IjoibW1yZWFsZXN0YXRldGVjaCIsImEiOiJjbHB3bjVsZ2EwZzByMm9wYmVtZDVwb2hyIn0.d66L0eAH0VLt2CvD8stQlw";let mapLocations={type:"FeatureCollection",features:[]},selectedMapLocations=[];const pitchMap=60;let map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mmrealestatetech/clvdp45qa00ku01qz7wx0gymq",center:[17.929102,43.808274],zoom:4.5});map.addControl(new mapboxgl.NavigationControl);let listLocations=document.getElementById("location-list").childNodes;function getGeoData(){listLocations.forEach((function(e){let t=e.querySelector("#locationLatitude").value,o=e.querySelector("#locationLongitude").value,a=e.querySelector(".locations-map_card").innerHTML,s={type:"Feature",geometry:{type:"Point",coordinates:[o,t]},properties:{id:e.querySelector("#locationID").value,description:a}};!1===mapLocations.features.includes(s)&&mapLocations.features.push(s)}))}function addMapPoints(){if(map.getLayer("locations")||map.addLayer({id:"locations",type:"circle",source:{type:"geojson",data:mapLocations,cluster:!0,clusterMaxZoom:10,clusterRadius:80},paint:{"circle-radius":10,"circle-stroke-width":2,"circle-stroke-color":"#23323D","circle-color":"#00FF47","circle-opacity":1}}),map.getLayer("clusters")||map.addLayer({id:"clusters",type:"circle",source:"locations",filter:["has","point_count"],paint:{"circle-color":"#fff","circle-radius":20}}),map.getLayer("cluster-count")||map.addLayer({id:"cluster-count",type:"symbol",source:"locations",filter:["has","point_count"],layout:{"text-field":["get","point_count_abbreviated"],"text-font":["DIN Offc Pro Bold","Arial Unicode MS Bold"],"text-size":16},paint:{"text-color":"#1b2433"}}),map.on("click","locations",(e=>{const t=e.features[0].geometry.coordinates.slice(),o=e.features[0].properties.description;for(;Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;o&&(new mapboxgl.Popup).setLngLat(t).setHTML(o).addTo(map)})),map.on("click","locations",(e=>{map.flyTo({center:e.features[0].geometry.coordinates,speed:.5,curve:1,bearing:-60,easing:e=>e})})),mapLocations.features.length>0){const e=new mapboxgl.LngLatBounds;mapLocations.features.forEach((function(t){e.extend([t.geometry.coordinates[0],t.geometry.coordinates[1]])})),map.fitBounds(e,{padding:40})}map.on("mouseenter","locations",(()=>{map.getCanvas().style.cursor="pointer"})),map.on("mouseleave","locations",(()=>{map.getCanvas().style.cursor=""})),map.on("mouseenter","clusters",(()=>{map.getCanvas().style.cursor="pointer"})),map.on("mouseleave","clusters",(()=>{map.getCanvas().style.cursor=""})),map.on("click","clusters",(e=>{const t=map.queryRenderedFeatures(e.point,{layers:["clusters"]}),o=t[0].properties.cluster_id;map.getSource("locations").getClusterExpansionZoom(o,((e,o)=>{e||map.easeTo({center:t[0].geometry.coordinates,zoom:o,bearing:-60})}))}))}getGeoData(),map.on("load",(function(e){addMapPoints()}));const countriesFilterWrap=document.getElementById("location-list");function handleCountriesFilter(){map.getLayer("locations")&&map.removeLayer("locations"),map.getLayer("clusters")&&map.removeLayer("clusters"),map.getLayer("cluster-count")&&map.removeLayer("cluster-count"),map.getSource("locations")&&map.removeSource("locations"),mapLocations.features=[],getGeoData(),addMapPoints()}window.fsAttributes=window.fsAttributes||[],window.fsAttributes.push(["cmsfilter",e=>{const[t]=e;t.listInstance.on("renderitems",(e=>{handleCountriesFilter()}))}]),$(".div-block-665").on("mouseenter",(function(){$(this).find(".card-bg-holder").css("transform","scale(1.05)")})),$(".div-block-665").on("mouseleave",(function(){$(this).find(".card-bg-holder").css("transform","scale(1)")}));const memberstack=window.$memberstackDom,updateButtonVisibility=async function(e,t){const o=e.getAttribute("ms-code-save-child"),a=await memberstack.getMemberJSON(),s=(a.data&&a.data[t]?a.data[t]:[]).includes(o),c=e;e.closest("[ms-code-save]").querySelectorAll(`[ms-code-unsave-child="${o}"]`).forEach((e=>{s?(c.style.display="none",e.style.display="block"):(c.style.display="block",e.style.display="none")}))},toggleLikeButton=async function(e,t){const o=e.getAttribute("ms-code-save-child"),a=await memberstack.getMemberJSON();a.data||(a.data={}),a.data[t]||(a.data[t]=[]);const s=a.data[t].includes(o),c=e.closest("[ms-code-save]").querySelectorAll(`[ms-code-unsave-child="${o}"]`);s?(a.data[t]=a.data[t].filter((e=>e!==o)),e.style.display="block",c.forEach((e=>{e.style.display="none"}))):(a.data[t].push(o),e.style.display="none",c.forEach((e=>{e.style.display="block"}))),await memberstack.updateMemberJSON({json:a.data}),updateButtonVisibility(e,t)};memberstack.getCurrentMember().then((({data:e})=>{if(e){document.querySelectorAll("[ms-code-save-child]").forEach((e=>{const t=e.getAttribute("ms-code-save")||e.closest("[ms-code-save]").getAttribute("ms-code-save");updateButtonVisibility(e,t),e.addEventListener("click",(async function(o){o.preventDefault(),await toggleLikeButton(e,t)}))}));document.querySelectorAll("[ms-code-unsave-child]").forEach((e=>{const t=e.getAttribute("ms-code-save")||e.closest("[ms-code-save]").getAttribute("ms-code-save");e.addEventListener("click",(async function(o){o.preventDefault();const a=e.closest("[ms-code-save]").querySelector(`[ms-code-save-child="${e.getAttribute("ms-code-unsave-child")}"]`);await toggleLikeButton(a,t)}))}))}else{const e=document.querySelectorAll("[ms-code-save-child]");document.querySelectorAll("[ms-code-unsave-child]").forEach((e=>{e.style.display="none"})),e.forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault(),memberstack.openModal("SIGNUP").then((e=>{memberstack.hideModal(),window.location.reload()}))}))}))}}));